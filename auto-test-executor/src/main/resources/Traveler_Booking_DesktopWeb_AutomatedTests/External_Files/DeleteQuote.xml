<?xml version="1.0" encoding="UTF-8"?>
<con:soapui-project id="9031a7dc-bbec-40ae-abbd-46a408d99057" activeEnvironment="Default" name="Delete Quote" resourceRoot="" soapui-version="5.3.0" abortOnError="false" runType="SEQUENTIAL" xmlns:con="http://eviware.com/soapui/config"><con:settings/><con:interface xsi:type="con:RestService" id="0c67de8b-6386-4b1b-8c37-a1b776876b28" wadlVersion="http://wadl.dev.java.net/2009/02" name="Delete Quote" type="rest" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:settings/><con:definitionCache type="TEXT" rootPart=""/><con:endpoints/><con:resource name="quote_id" path="api/v4/requested_trips/{request_id}/quotes/{quote_id}" id="47055447-948b-4bf6-bba5-82527c89c8ea"><con:settings/><con:parameters><con:parameter><con:name>request_id</con:name><con:value/><con:style>TEMPLATE</con:style><con:default/><con:description xsi:nil="true"/></con:parameter><con:parameter><con:name>quote_id</con:name><con:value/><con:style>TEMPLATE</con:style><con:default/><con:description xsi:nil="true"/></con:parameter><con:parameter><con:name>security_auth_token</con:name><con:value>ekxnfvoxefmpelbvzuerofqmtcffxxcuwengpdrvwwgrbajkrk</con:value><con:style>QUERY</con:style><con:default>ekxnfvoxefmpelbvzuerofqmtcffxxcuwengpdrvwwgrbajkrk</con:default></con:parameter></con:parameters><con:method name="Method 1" id="aa0fd075-702a-4dac-9e4f-f4ad70d39add" method="DELETE"><con:settings/><con:parameters/><con:representation type="REQUEST"><con:mediaType>application/json</con:mediaType><con:params/></con:representation><con:representation type="RESPONSE"><con:mediaType xsi:nil="true"/><con:status>0</con:status><con:params/><con:element>data</con:element></con:representation><con:representation type="FAULT"><con:mediaType>application/json; charset=utf-8</con:mediaType><con:status>406 403</con:status><con:params/></con:representation><con:representation type="RESPONSE"><con:mediaType>text/html; charset=utf-8</con:mediaType><con:status>200</con:status><con:params/></con:representation><con:representation type="RESPONSE"><con:mediaType>text/html</con:mediaType><con:status>200</con:status><con:params/><con:element>html</con:element></con:representation><con:representation type="FAULT"><con:mediaType>text/html; charset=utf-8</con:mediaType><con:status>404</con:status><con:params/><con:element>html</con:element></con:representation><con:representation type="RESPONSE"><con:mediaType>application/json; charset=utf-8</con:mediaType><con:status>200</con:status><con:params/><con:element xmlns:ns="https://bookings-qa1.ttdev.in/requested_trips/1703876/quotes/3076091">ns:Response</con:element></con:representation><con:request name="Request 1" id="5357a8d8-9be2-4562-b899-a79116d78842" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="Accept" value="application/json"/>
  &lt;con:entry key="Content-Type" value="application/json; charset=UTF-8"/>
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>https://${#Project#traveler_apiendpoint}</con:endpoint><con:request/><con:originalUri>https://null///requested_trips//quotes/</con:originalUri><con:credentials><con:username>ttuser</con:username><con:password>ttuser</con:password><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="security_auth_token" value="ekxnfvoxefmpelbvzuerofqmtcffxxcuwengpdrvwwgrbajkrk" xmlns="http://eviware.com/soapui/config"/></con:parameters><con:parameterOrder><con:entry>request_id</con:entry><con:entry>quote_id</con:entry><con:entry>security_auth_token</con:entry></con:parameterOrder></con:request></con:method></con:resource></con:interface><con:interface xsi:type="con:RestService" id="c7a20fdf-cc25-4920-ac2c-e8a27907f7e1" wadlVersion="http://wadl.dev.java.net/2009/02" name="SIGININ" type="rest" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:settings/><con:definitionCache type="TEXT" rootPart=""/><con:endpoints/><con:resource name="sign_in" path="/users/sign_in" id="aeaaa9bb-c821-46f7-8830-6ce2683a67e8"><con:settings/><con:parameters/><con:method name="Method 1" id="b6a5da24-84b0-48ea-a257-bcd0c99856c6" method="POST"><con:settings/><con:parameters/><con:representation type="RESPONSE"><con:mediaType>application/json; charset=utf-8</con:mediaType><con:status>200</con:status><con:params/><con:element xmlns:sign="https://bookings-qa1.ttdev.in/users/sign_in">sign:Response</con:element></con:representation><con:representation type="REQUEST"><con:mediaType>application/json</con:mediaType><con:params/></con:representation><con:request name="Request 1" id="013a6e6b-5a97-4a25-af54-4041c5f685b3" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers"><![CDATA[<xml-fragment xmlns:con="http://eviware.com/soapui/config">
  <con:entry key="TT-Mobile-Post" value="testing1112015a@rediffmail.com"/>
  <con:entry key="TT-Mobile" value=""/>
  <con:entry key="Content-Type" value="application/json; charset=UTF-8"/>
  <con:entry key="Accept" value="application/json"/>
</xml-fragment>]]></con:setting></con:settings><con:endpoint>https://${#Project#traveler_apiendpoint}</con:endpoint><con:request>{"login_type":"json","user":{"email":"testing1112015a@rediffmail.com","password":"testing00000007"}}</con:request><con:credentials><con:username>ttuser</con:username><con:password>ttuser</con:password><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:request></con:method></con:resource></con:interface><con:testSuite id="4417a634-85b8-426d-a877-7a0abd2c9c7b" name="AgentDeletesTheQuote"><con:settings/><con:runType>SEQUENTIAL</con:runType><con:testCase id="5b701b63-bdec-42fc-a862-c42f445bb3da" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Agent_Delete_The_Quote" searchProperties="true"><con:settings/><con:testStep type="calltestcase" name="Given user gets the hash key" id="b46f8be9-e67a-459d-b20a-457f365ba4fa"><con:settings/><con:config xsi:type="con:RunTestCaseStep" copyHttpSession="true" copyLoadTestProperties="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:targetTestCase>18bc5b13-6e7c-4c21-98e5-b8250d3061d3</con:targetTestCase><con:properties><con:property><con:name>request_url</con:name><con:value>http://${#TestCase#endpoint}/users/sign_in</con:value></con:property><con:property><con:name>user_email</con:name><con:value>${#TestCase#user_email}</con:value></con:property><con:property><con:name>request_type</con:name><con:value>post</con:value></con:property><con:property><con:name>hash_key</con:name><con:value>Po4FvUhKl0B4sB3ljUTS2wPuM/yPNeAh/Cl6XUvmP1c=</con:value></con:property></con:properties><con:returnProperties><con:entry>hash_key</con:entry></con:returnProperties><con:runMode>SINGLETON_AND_WAIT</con:runMode></con:config></con:testStep><con:testStep type="restrequest" name="Then User Login with valid credentials" id="18413ecd-8f51-43c9-b851-b763cac9fa40"><con:settings/><con:config service="SIGININ" resourcePath="/users/sign_in" methodName="Method 1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Then User Login with valid credentials" id="013a6e6b-5a97-4a25-af54-4041c5f685b3" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="TT-Mobile" value="${Given user gets the hash key#hash_key}"/>
  &lt;con:entry key="Accept" value="application/json"/>
  &lt;con:entry key="Content-Type" value="application/json; charset=UTF-8"/>
&lt;/xml-fragment></con:setting></con:settings><con:endpoint>https://${#TestCase#endpoint}</con:endpoint><con:request>{"login_type":"json","user":{"email":"${#TestCase#user_email}","password":"${#TestCase#user_password}"}}</con:request><con:originalUri>https://bookings-qa1.ttdev.in/users/sign_in</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="b452b4d4-60d6-4fc3-9653-c0577dbc433c" name="Valid HTTP Status Codes"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:assertion type="Simple Contains" id="275e7ba4-7df2-48c8-be2a-dde848c17109" name="EmailExistsInResponse"><con:configuration><token>${#TestCase#user_email}</token><ignoreCase>true</ignoreCase><useRegEx>false</useRegEx></con:configuration></con:assertion><con:assertion type="GroovyScriptAssertion" id="e09b21ac-2240-4a96-8eee-e07b69afa29d" name="Get the response cookie"><con:configuration><scriptText>for(String cookie in messageExchange.getResponseHeaders()["Set-Cookie"]){
	if(cookie.contains("_trips3m_session")){
		messageExchange.modelItem.testCase.setPropertyValue("Cookie",cookie);
	}
}</scriptText></con:configuration></con:assertion><con:assertion type="GroovyScriptAssertion" id="f4ee86cf-012a-4b1b-a20a-197a189189a5" name="Get user details"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json_response_holder = new JsonSlurper().parseText(response);

String user_id = json_response_holder.current_user.id.toString();

String redirect = json_response_holder.redirect;

String auth_key = json_response_holder.current_user.pubnub_auth.auth_key;

messageExchange.modelItem.testCase.setPropertyValue("user_id",user_id);

messageExchange.modelItem.testCase.setPropertyValue("auth_key",auth_key);
messageExchange.modelItem.testCase.setPropertyValue("redirect",redirect);</scriptText></con:configuration></con:assertion><con:credentials><con:username>ttuser</con:username><con:password>ttuser</con:password><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="calltestcase" name="Given user gets the hash key for deleting quote" id="615f240e-0ddb-4f63-99bd-fb7625218540"><con:settings/><con:config xsi:type="con:RunTestCaseStep" copyHttpSession="true" copyLoadTestProperties="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:targetTestCase>18bc5b13-6e7c-4c21-98e5-b8250d3061d3</con:targetTestCase><con:properties><con:property><con:name>request_url</con:name><con:value>http://${#TestCase#endpoint}/requested_trips/{request_id}/quotes/{quote_id}</con:value></con:property><con:property><con:name>user_email</con:name><con:value>${#TestCase#user_email}</con:value></con:property><con:property><con:name>request_type</con:name><con:value>delete</con:value></con:property><con:property><con:name>hash_key</con:name><con:value>z1bs/N7NFvXXN1ZAK5EcH5hUgPUPDicmcPU6GinO7oE=</con:value></con:property></con:properties><con:returnProperties><con:entry>hash_key</con:entry></con:returnProperties><con:runMode>SINGLETON_AND_WAIT</con:runMode></con:config></con:testStep><con:testStep type="restrequest" name="Then Agent Deletes the quote" id="dd58fcd4-8984-4588-b586-7203c51cdb2b"><con:settings/><con:config service="Delete Quote" methodName="Method 1" resourcePath="/api/v4/requested_trips/{request_id}/quotes/{quote_id}" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Then Agent Deletes the quote" id="bdd103b9-c17f-4912-851d-78d5ddf2b4d0" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers"><![CDATA[<xml-fragment xmlns:con="http://eviware.com/soapui/config">
  <con:entry key="Cookie" value="${#TestCase#Cookie}"/>
  <con:entry key="TT-Mobile" value="${Given user gets the hash key for deleting quote#hash_key}"/>
  <con:entry key="TT-Mobile-post" value="${#TestCase#user_email}"/>
  <con:entry key="Content-Type" value="application/json"/>
</xml-fragment>]]></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>https://${#TestCase#endpoint}</con:endpoint><con:request/><con:originalUri>https://bookings-qa1.ttdev.in/requested_trips/1703876/quotes/3076091</con:originalUri><con:assertion type="Valid HTTP Status Codes" id="e4ffed38-3def-41f6-af57-7f4a0c91d550" name="Valid HTTP Status Codes"><con:configuration><codes>200</codes></con:configuration></con:assertion><con:assertion type="GroovyScriptAssertion" id="3214928e-3e8c-4784-9fbd-0a531ac68b12" name="Script Assertion"><con:configuration><scriptText>import groovy.json.JsonSlurper;

String response = messageExchange.getResponseContent();
def json_response_holder = new JsonSlurper().parseText(response);

String message = json_response_holder.message;

messageExchange.modelItem.testCase.setPropertyValue("message",message);</scriptText></con:configuration></con:assertion><con:credentials><con:username>ttuser</con:username><con:password>ttuser</con:password><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="request_id" value="${#TestCase#request_id}"/>
  <con:entry key="quote_id" value="${#TestCase#quote_id}"/>
  <con:entry key="security_auth_token" value="ekxnfvoxefmpelbvzuerofqmtcffxxcuwengpdrvwwgrbajkrk"/>
</con:parameters><con:parameterOrder><con:entry>request_id</con:entry><con:entry>quote_id</con:entry><con:entry>security_auth_token</con:entry></con:parameterOrder></con:restRequest></con:config></con:testStep><con:properties><con:property><con:name>endpoint</con:name><con:value>bookings-qa1.ttdev.in</con:value></con:property><con:property><con:name>user_email</con:name><con:value>ttagentdemo@gmail.com</con:value></con:property><con:property><con:name>user_password</con:name><con:value>abc123</con:value></con:property><con:property><con:name>request_id</con:name><con:value>1742226</con:value></con:property><con:property><con:name>quote_id</con:name><con:value>3147593</con:value></con:property><con:property><con:name>Cookie</con:name><con:value>_trips3m_session=BAh7CEkiD3Nlc3Npb25faWQGOgZFVEkiJWNkN2YyNTgzOTk2YjQxOTM3YTM5NDFlNDMwMDlhYmRmBjsAVEkiGXdhcmRlbi51c2VyLnVzZXIua2V5BjsAVFsHWwZpA6ELA0kiIiQyYSQxMCRRdTBBa2ZXRGg1NjlXckFmcHZ3TmplBjsAVEkiDHJlZmVyZXIGOwBUSSIABjsAVA%3D%3D--23121ffb9148653bc91c3513cd08e45d5e60392d; path=/; HttpOnly</con:value></con:property><con:property><con:name>user_id</con:name><con:value>199585</con:value></con:property><con:property><con:name>auth_key</con:name><con:value>cb577024cb1d11e5b32d22000b030ad5</con:value></con:property><con:property><con:name>redirect</con:name><con:value>/agents/dashboard</con:value></con:property><con:property><con:name>message</con:name><con:value>Quote has been successfully deleted</con:value></con:property></con:properties></con:testCase><con:properties/></con:testSuite><con:testSuite id="9d05531d-6f18-49f1-8bae-ea4c1e739cc1" name="ReusableTests" disabled="true"><con:settings/><con:runType>SEQUENTIAL</con:runType><con:testCase id="18bc5b13-6e7c-4c21-98e5-b8250d3061d3" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="CreateToken" searchProperties="true"><con:settings/><con:testStep type="groovy" name="Groovy Script" id="ad525420-f1d0-4817-a807-86838a9497eb"><con:settings/><con:config><script>import java.security.MessageDigest;
import org.codehaus.groovy.runtime.EncodingGroovyMethods;


String requestUrl = context.expand('${#TestCase#request_url}');
String userEmail = context.expand('${#TestCase#user_email}');
String requestType = context.expand('${#TestCase#request_type}');
log.info requestUrl;
String digest;

if( requestType == "get" ){
  	digest = requestUrl; 
} else {
digest = userEmail + requestType;
}

digest = getUserDigest(digest); //this is final digest

log.info digest;
testRunner.testCase.setPropertyValue("hash_key",digest);

String getUserDigest(String digest) {
   String TT_S_KEY = "DAFAC0A55F50A75558B778035E3C9A8BDF03AF1E4C2124D2CD5DD42092EFD32E";
   try {
       digest = TT_S_KEY + digest;
       MessageDigest msgDigest = MessageDigest.getInstance("SHA-256");
       msgDigest.update(digest.getBytes());
       EncodingGroovyMethods encodeObj = new EncodingGroovyMethods();
       //digest = new String(Base64.encode(msgDigest.digest(), Base64.DEFAULT));
       digest = encodeObj.encodeBase64(msgDigest.digest()).toString();
       if (digest.length() > 164) {
           digest = digest.substring(0, 163);
       }
       return digest;
   } catch (Exception e) {
       log.info e.getMessage();
   }
   return null;
}
</script></con:config></con:testStep><con:properties><con:property><con:name>request_url</con:name><con:value>http://bookings-qa1.ttdev.in/requested_trips/{request_id}/quotes/{quote_id}</con:value></con:property><con:property><con:name>user_email</con:name><con:value>ttagentdemo@gmail.com</con:value></con:property><con:property><con:name>request_type</con:name><con:value>delete</con:value></con:property><con:property><con:name>hash_key</con:name><con:value>z1bs/N7NFvXXN1ZAK5EcH5hUgPUPDicmcPU6GinO7oE=</con:value></con:property></con:properties><con:reportParameters/></con:testCase><con:properties/><con:reportParameters/></con:testSuite><con:properties/><con:wssContainer/><con:oAuth2ProfileContainer/><con:oAuth1ProfileContainer/><con:sensitiveInformation/></con:soapui-project>